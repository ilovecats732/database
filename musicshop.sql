CREATE DATABASE IF NOT EXISTS MusicShop;

USE MusicShop;

CREATE TABLE employees
(
    id INT PRIMARY KEY,
    full_name VARCHAR(100),
    town_name VARCHAR(100),
    salary INT,
    shop_id INT
);

CREATE TABLE shops
(
    shop_id INT PRIMARY KEY,
    address VARCHAR(100),
    employee_id INT,
    town_name VARCHAR(100),
    open_time TIME,
    close_time TIME,
    date_opened DATE
);

CREATE TABLE products_sold
(
    shop_product_id INT PRIMARY KEY,
    shop_id INT,
    product_id INT,
    product_type VARCHAR(100),
    amount_sold_monthly INT
);

CREATE TABLE products
(
    product_id INT PRIMARY KEY,
    product_type VARCHAR(100),
    product_name VARCHAR(100),
    manufacturer VARCHAR(100),
    price INT,
    amount_left_in_stock INT
);

CREATE TABLE online_magazin
(
    order_id INT PRIMARY KEY,
    product_id INT,
    customer_name VARCHAR(100),
    date_ordered DATE,
    shop_id INT,
    delivery_address VARCHAR(100)
);

INSERT INTO employees (id, full_name, town_name, salary, shop_id) VALUES
(1, 'Валентина Георгиева Петрова', 'Пловдив', 37000, 001),
(2, 'Мартин Иванов Георгиев', 'София', 36000, 002),
(3, 'Петър Симеонов Симеонов', 'Варна', 36000, 003),
(4, 'Росен Стефанов Георгиев', 'Бургас', 35000, 004),
(5, 'Теодора Николова Стефанова', 'Русе', 35000, 005),
(6, 'Деонисий Десислав Томов', 'Велико Търново', 3300000, 006),
(7, 'Александър Стефанов Иванов', 'Благоевград', 33000, 007),
(8, 'Даниел Георгиев Петков', 'Плевен', 32000, 008),
(9, 'Живка Петкова Николова', 'Стара Загора', 34000, 009),
(10, 'Кристиян Стефанов Стефанов', 'Хасково',34000, 010),
(11, 'Магдалена Петрова Георгиева', 'Ямбол',32000, 011),
(12, 'Симеон Симеонов Петров', 'Сливен',34000, 012),
(13, 'Йордан Георгиев Симеонов', 'Разград',31000, 013),
(14, 'Ангела Стефанова Георгиева', 'Ловеч',32000, 014),
(15, 'Стефан Петров Стефанов', 'Кюстендил',31000, 015),
(16, 'Велизар Добрев Колев', 'Пазарджик',30000, 016),
(17, 'Елица Георгиева Петрова', 'Враца',32000, 017),
(18, 'Николай Николов Стефанов', 'Търговище',33000, 018),
(19, 'Веселин Симеонов Георгиев', 'Силистра',34000, 019),
(20, 'Ясен Иванов Видински', 'Карнобат',31000, 020);

INSERT INTO shops (shop_id, address, employee_id, town_name, open_time, close_time, date_opened) VALUES
(001, 'бул. Витоша 15', 1, 'София', '09:00:00', '18:30:00', '2016-06-27'),
(002, 'ул. Капитан Райчо 7', 2, 'Пловдив', '09:00:00', '18:30:00', '2014-12-19'),
(003, 'ул. Княз Борис I 42', 3, 'Варна', '09:00:00', '18:30:00', '2017-01-20'),
(004, 'бул. Демокрация 3', 4, 'Бургас', '09:00:00', '18:30:00', '2017-01-20'),
(005, 'ул. Александър Пушкин 11', 5, 'Русе', '09:00:00', '18:30:00', '2017-01-20'),
(006, 'бул. България 23', 6, 'Велико Търново', '09:00:00', '18:30:00', '2017-03-17'),
(007, 'ул. Свобода 31', 7, 'Благоевград', '09:00:00', '18:30:00', '2019-09-12'),
(008, 'ул. Иван Вазов 9', 8, 'Плевен', '09:00:00', '18:30:00', '2017-03-17'),
(009, 'бул. Славянска 77', 9, 'Стара Загора', '09:00:00', '18:30:00', '2018-04-03'),
(010, 'ул. Стоян Заимов 2', 10, 'Хасково', '09:00:00', '18:30:00', '2019-08-10'),
(011, 'ул. Хан Крум 14', 11, 'Ямбол', '09:00:00', '18:30:00', '2019-11-14'),
(012, 'бул. Александър Батенберг 20', 12, 'Сливен', '09:00:00', '18:30:00', '2019-12-04'),
(013, 'ул. Хан Аспарух 5', 13, 'Разград', '09:00:00', '18:30:00', '2022-05-25'),
(014, 'бул. Славейков 8', 14, 'Ловеч', '09:00:00', '18:30:00', '2017-03-17'),
(015, 'ул. Гоце Делчев 16', 15, 'Кюстендил', '09:00:00', '18:30:00', '2022-05-25'),
(016, 'ул. Александър Стамболийски 12', 16, 'Пазарджик', '09:00:00', '18:30:00', '2018-04-03'),
(017, 'бул. Васил Левски 21', 17, 'Враца', '09:00:00', '18:30:00', '2017-03-17'),
(018, 'ул. Дамян Груев 3', 18, 'Търговище', '09:00:00', '18:30:00', '2022-05-25'),
(019, 'бул. Свети Никола 45', 19, 'Силистра', '09:00:00', '18:30:00', '2022-07-13'),
(020, 'ул. Гео Милев 10', 20, 'Карнобат', '09:00:00', '18:30:00', '2023-02-28');

INSERT INTO products_sold (shop_product_id, shop_id, product_type, amount_sold_monthly) VALUES
(1, 001, 'Китара', 49),
(2, 001, 'Аксесоар', 90),
(3, 001, 'Духов инструмент', 9),
(4, 001, 'Ударен инструмент', 12),
(5, 001, 'Клавишен инструмент', 18),
(6, 002, 'Китара', 39),
(7, 002, 'Аксесоар', 86),
(8, 002, 'Духов инструмент', 8),
(9, 002, 'Ударен инструмент', 7),
(10, 002, 'Клавишен инструмент', 10),
(11, 003, 'Китара', 35),
(12, 003, 'Аксесоар', 79),
(13, 003, 'Духов инструмент', 6),
(14, 003, 'Ударен инструмент', 9),
(15, 003, 'Клавишен инструмент', 8),
(16, 004, 'Китара', 45),
(17, 004, 'Аксесоар', 81),
(18, 004, 'Духов инструмент', 8),
(19, 004, 'Ударен инструмент', 5),
(20, 004, 'Клавишен инструмент', 8),
(21, 005, 'Китара', 28),
(22, 005, 'Аксесоар', 75),
(23, 005, 'Духов инструмент', 7),
(24, 005, 'Ударен инструмент', 4),
(25, 005, 'Клавишен инструмент', 10),
(26, 006, 'Китара', 32),
(27, 006, 'Аксесоар', 78),
(28, 006, 'Духов инструмент', 8),
(29, 006, 'Ударен инструмент', 6),
(30, 006, 'Клавишен инструмент', 5),
(31, 007, 'Китара', 25),
(32, 007, 'Аксесоар', 73),
(33, 007, 'Духов инструмент', 6),
(34, 007, 'Ударен инструмент', 4),
(35, 007, 'Клавишен инструмент', 8),
(36, 008, 'Китара', 28),
(37, 008, 'Аксесоар', 82),
(38, 008, 'Духов инструмент', 10),
(39, 008, 'Ударен инструмент', 5),
(40, 008, 'Клавишен инструмент', 6),
(41, 009, 'Китара', 30),
(42, 009, 'Аксесоар', 88),
(43, 009, 'Духов инструмент', 11),
(44, 009, 'Ударен инструмент', 9),
(45, 009, 'Клавишен инструмент', 12),
(46, 010, 'Китара', 35),
(47, 010, 'Аксесоар', 83),
(48, 010, 'Духов инструмент', 5),
(49, 010, 'Ударен инструмент', 9),
(50, 010, 'Клавишен инструмент', 8),
(51, 011, 'Китара', 31),
(52, 011, 'Аксесоар', 78),
(53, 011, 'Духов инструмент', 9),
(54, 011, 'Ударен инструмент', 6),
(55, 011, 'Клавишен инструмент', 10),
(56, 012, 'Китара', 28),
(57, 012, 'Аксесоар', 75),
(58, 012, 'Духов инструмент', 11),
(59, 012, 'Ударен инструмент', 3),
(60, 012, 'Клавишен инструмент', 7),
(61, 013, 'Китара', 27),
(62, 013, 'Аксесоар', 72),
(63, 013, 'Духов инструмент', 10),
(64, 013, 'Ударен инструмент', 9),
(65, 013, 'Клавишен инструмент', 13),
(66, 014, 'Китара', 30),
(67, 014, 'Аксесоар', 88),
(68, 014, 'Духов инструмент', 5),
(69, 014, 'Ударен инструмент', 11),
(70, 014, 'Клавишен инструмент', 12),
(71, 015, 'Китара', 35),
(72, 015, 'Аксесоар', 82),
(73, 015, 'Духов инструмент', 13),
(74, 015, 'Ударен инструмент', 5),
(75, 015, 'Клавишен инструмент', 9),
(76, 016, 'Китара', 23),
(77, 016, 'Аксесоар', 69),
(78, 016, 'Духов инструмент', 11),
(79, 016, 'Ударен инструмент', 8),
(80, 016, 'Клавишен инструмент', 10),
(81, 017, 'Китара', 26),
(82, 017, 'Аксесоар', 75),
(83, 017, 'Духов инструмент', 5),
(84, 017, 'Ударен инструмент', 7),
(85, 017, 'Клавишен инструмент', 8),
(86, 018, 'Китара', 28),
(87, 018, 'Аксесоар', 72),
(88, 018, 'Духов инструмент', 10),
(89, 018, 'Ударен инструмент', 4),
(90, 018, 'Клавишен инструмент', 5),
(91, 019, 'Китара', 22),
(92, 019, 'Аксесоар', 88),
(93, 019, 'Духов инструмент', 13),
(94, 019, 'Ударен инструмент', 15),
(95, 019, 'Клавишен инструмент', 17),
(96, 020, 'Китара', 17),
(97, 020, 'Аксесоар', 68),
(98, 020, 'Духов инструмент', 27),
(99, 020, 'Ударен инструмент', 8),
(100, 020, 'Клавишен инструмент', 7);

INSERT INTO online_magazin (order_id, product_id, customer_name, date_ordered, shop_id, delivery_address) VALUES
(1, 101, 'Петър Иванов', '2024-01-28', '008', 'София, бул. Витоша 15'),
(2, 102, 'Мария Георгиева', '2024-01-29', '014', 'Пловдив, ул. Главна 10'),
(3, 103, 'Ангела Димитрова', '2024-01-30', '011', 'Варна, бул. Черно море 5'),
(4, 104, 'Георги Стефанов', '2024-01-31', '003', 'София, ул. Славянска 8'),
(5, 105, 'Светлана Петрова', '2024-02-01', '020', 'Плевен, бул. Република 25'),
(6, 106, 'Иван Илиев', '2024-02-02', '018', 'Бургас, ул. Лазур 12'),
(7, 107, 'Елена Георгиева', '2024-02-03', '001', 'София, ул. Оборище 3'),
(8, 108, 'Николай Милев', '2024-02-04', '006', 'Велико Търново, ул. Стара планина 9'),
(9, 109, 'Десислава Ангелова', '2024-02-05', '013', 'Русе, бул. Липник 17'),
(10, 110, 'Станислав Иванов', '2024-02-06', '002', 'София, ж.к. Младост 1, бл. 3'),
(11, 111, 'Магдалена Петкова', '2024-02-07', '016', 'Стара Загора, ул. Цар Иван Асен II 20'),
(12, 112, 'Христо Димитров', '2024-02-08', '019', 'Пазарджик, ул. Хан Аспарух 7'),
(13, 113, 'Гергана Николова', '2024-02-09', '005', 'София, бул. Цариградско шосе 33'),
(14, 114, 'Павлина Георгиева', '2024-02-10', '009', 'Варна, ул. Генерал Колев 14'),
(15, 115, 'Ивайло Ангелов', '2024-02-11', '017', 'Сливен, ул. Хан Крум 2'),
(16, 116, 'Росица Петкова', '2024-02-12', '015', 'София, кв. Лозенец, ул. Люлин 5'),
(17, 117, 'Красимир Стефанов', '2024-02-13', '012', 'Благоевград, бул. Македония 19'),
(18, 118, 'Елица Николова', '2024-02-14', '004', 'Шумен, ул. Александър Стамболийски 8'),
(19, 119, 'Ивана Георгиева', '2024-02-15', '010', 'София, ул. Христо Ботев 23'),
(20, 120, 'Атанас Атанасов', '2024-02-16', '007', 'Плевен, кв. Кайлъка, бл. 7'),
(21, 121, 'Галина Илиева', '2024-02-17', '003', 'Бургас, кв. Лазур, бл. 2'),
(22, 122, 'Димитър Димитров', '2024-02-18', '014', 'София, ул. Пирин 11'),
(23, 123, 'Силвия Стефанова', '2024-02-19', '008', 'Велико Търново, ул. Цар Шишман 16'),
(24, 124, 'Валентин Василев', '2024-02-20', '006', 'Русе, кв. Владиславово, бл. 4'),
(25, 125, 'Ева Иванова', '2024-02-21', '011', 'София, ж.к. Люлин 9, бл. 55'),
(26, 126, 'Стоян Стоянов', '2024-02-22', '016', 'Стара Загора, кв. Жълтите камъни, ул. Кольо Фичето 3'),
(27, 127, 'Милена Милева', '2024-02-23', '002', 'Пазарджик, ул. Пловдивска 7'),
(28, 128, 'Борислав Борисов', '2024-02-24', '015', 'София, ул. Граф Игнатиев 30'),
(29, 129, 'Даниела Димитрова', '2024-02-25', '004', 'Варна, ж.к. Чайка, бл. 12'),
(30, 130, 'Петя Петкова', '2024-02-26', '013', 'Сливен, кв. Орпей, ул. Васил Левски');

INSERT INTO products (product_id, product_type, product_name, manufacturer, price, amount_left_in_stock) VALUES
(101, 'Китара', 'Бас китара', 'Fender', 800, 5),
(102, 'Китара', 'Акустична китара', 'Yamaha', 600, 8),
(103, 'Китара', 'Електрическа китара', 'Gibson', 1200, 3),
(104, 'Ударен инструмент', 'Акустични барабани', 'Pearl', 1500, 2),
(105, 'Аксесоар', 'Калъф за китара', 'Generic', 50, 15),
(106, 'Аксесоар', 'Струни за китара', 'Daddario', 10, 100),
(107, 'Китара', 'Класическа китара', 'Cordoba', 500, 6),
(108, 'Клавишен инструмент', 'Синтезатор', 'Roland', 1000, 4),
(109, 'Духов инструмент', 'Туба', 'Jupiter', 1800, 1),
(110, 'Аксесоар', 'Кабел за китара', 'Mogami', 30, 20),
(111, 'Ударен инструмент', 'Електронен барабан', 'Alesis', 700, 5),
(112, 'Аксесоар', 'Стойка за китара', 'Hercules', 40, 18),
(113, 'Китара', 'Електрическа китара', 'Jackson', 1200, 2),
(114, 'Аксесоар', 'Метроном', 'Wittner', 25, 25),
(115, 'Духов инструмент', 'Саксофон', 'Yanagisawa', 2000, 3),
(116, 'Аксесоар', 'Педал за ефекти', 'Boss', 80, 15),
(117, 'Духов инструмент', 'Тромпет', 'Bach', 900, 7),
(118, 'Аксесоар', 'Струни за бас китара', 'Ernie Ball', 15, 30),
(119, 'Китара', 'Акустична китара', 'Fender', 550, 5),
(120, 'Китара', 'Електрическа китара', 'Epiphone', 1500, 2),
(121, 'Аксесоар', 'Стойка за микрофон', 'K&M', 50, 25),
(122, 'Китара', 'Електрическа китара', 'Ibanez', 1400, 15),
(123, 'Клавишен инструмент', 'Синтезатор', 'Korg', 800, 5),
(124, 'Аксесоар', 'Поставка за ноти', 'Manhasset', 35, 22),
(125, 'Аксесоар', 'Струни за китара', 'Ernie ball', 16, 15),
(126, 'Аксесоар', 'Калъф за тамбурина', 'Protection Racket', 25, 18),
(127, 'Китара', 'Акустична китара', 'Gibson', 9600, 1),
(128, 'Аксесоар', 'Струни за китара', 'Elixir', 34, 15),
(129, 'Китара', 'Електрическа китара', 'Gretsch', 600, 5),
(130, 'Китара', 'Класическа китара', 'Yamaha', 320, 5),
(131, 'Аксесоар', 'Метален стенд за ноти', 'On-Stage', 45, 20),
(132, 'Китара', 'Електрическа китара', 'EVH', 2000, 2),
(133, 'Духов инструмент', 'Хармоника', 'Hohner', 50, 15),
(134, 'Аксесоар', 'Микрофон за ударни', 'Shure', 120, 8),
(135, 'Духов инструмент', 'Тромбон', 'Bach', 1000, 5),
(136, 'Аксесоар', 'Педал за пиано', 'Roland', 70, 18),
(137, 'Аксесоар', 'Стойка за пиано', 'K&M', 55, 17),
(138, 'Китара', 'Електрическа китара', 'Kramer', 1400, 3),
(139, 'Духов инструмент', 'Гайда', 'Thrace Bagpipes', 1200, 3),
(140, 'Аксесоар', 'Светещи струни за китара', 'DR Strings', 20, 30),
(141, 'Китара', 'Електрическа китара', 'Stagg', 500, 4),
(142, 'Инструмент', 'Панпайп', 'Andean Spirit', 80, 15),
(143, 'Аксесоар', 'Адаптер за слушалки', 'Behringer', 15, 40),
(144, 'Инструмент', 'Цигулка', 'Stradivarius', 2000, 2),
(145, 'Инструмент', 'Кларинет', 'Buffet Crampon', 1200, 4),
(146, 'Аксесоар', 'Полицейски свирка', 'Acme', 10, 50),
(147, 'Инструмент', 'Котел', 'Sonor', 300, 6),
(148, 'Инструмент', 'Шейхат', 'Turkish Percussion', 90, 20),
(149, 'Инструмент', 'Мелодика', 'Hohner', 40, 15),
(150, 'Аксесоар', 'Поставка за музикални книги', 'Manhasset', 35, 22),
(151, 'Инструмент', 'Маримба', 'Adams', 1800, 2),
(152, 'Аксесоар', 'Свирка за подложка', 'Vandoren', 25, 25),
(153, 'Инструмент', 'Орфей', 'Studio 49', 120, 8),
(154, 'Аксесоар', 'Стойка за микрофон', 'On-Stage', 40, 18),
(155, 'Инструмент', 'Тамбурин', 'Meinl', 30, 25),
(156, 'Инструмент', 'Глокеншпил', 'Bergerault', 400, 5),
(157, 'Инструмент', 'Маракас', 'Latin Percussion', 20, 30),
(158, 'Аксесоар', 'Светеща тунинг вилица', 'Snark', 15, 40),
(159, 'Инструмент', 'Фисгармония', 'Beltuna', 1000, 3),
(160, 'Инструмент', 'Вибрафон', 'Musser', 2500, 1),
(161, 'Инструмент', 'Дигериду', 'Australian Workshop', 150, 8),
(162, 'Инструмент', 'Бенджо', 'Deering', 800, 5),
(163, 'Аксесоар', 'Калъф за маракас', 'Protec', 25, 18),
(164, 'Инструмент', 'Бъзуки', 'Canto', 700, 7),
(165, 'Инструмент', 'Шанай', 'Turkish Wind', 120, 12),
(166, 'Аксесоар', 'Чанта за дигериду', 'Gator', 35, 15);

ALTER TABLE employees
    ADD FOREIGN KEY (shop_id) REFERENCES shops(shop_id);

ALTER TABLE shops
    ADD FOREIGN KEY (employee_id) REFERENCES employees(id);

ALTER TABLE products_sold
    ADD FOREIGN KEY (shop_id) REFERENCES shops(shop_id),
    ADD FOREIGN KEY (product_id) REFERENCES products(product_id);

ALTER TABLE online_magazin
    ADD FOREIGN KEY (product_id) REFERENCES products(product_id),
    ADD FOREIGN KEY (shop_id) REFERENCES shops(shop_id);

SELECT
    e.full_name AS employee_name,
    e.town_name,
    e.salary,
    s.address AS shop_address,
    COALESCE(SUM(ps.amount_sold_monthly), 0) AS total_monthly_sales
FROM
    employees e
JOIN
    shops s ON e.shop_id = s.shop_id
LEFT JOIN
    products_sold ps ON s.shop_id = ps.shop_id
GROUP BY
    e.full_name, e.town_name, e.salary, s.address
ORDER BY
    total_monthly_sales DESC;

SELECT
    online_magazin.order_id,
    online_magazin.customer_name,
    online_magazin.delivery_address,
    products.*
FROM
    online_magazin
INNER JOIN
    products ON online_magazin.product_id = products.product_id;

SELECT product_type, SUM(amount_sold_monthly) AS total_monthly_sales
FROM products_sold
GROUP BY product_type;

SELECT
    shop_id,
    address AS shop_address,
    DATEDIFF(CURDATE(), date_opened) AS days_open
FROM
    shops;

SELECT product_id, product_name, amount_left_in_stock
FROM products;

SELECT
    AVG(e.salary) AS average_company_salary
FROM
    employees e;